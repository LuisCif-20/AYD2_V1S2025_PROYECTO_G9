<p-toolbar class="mb-4">
  <ng-template #start>
    <p-button
      (onClick)="openNew()"
      icon="pi pi-plus"
      label="Nuevo"
      class="mr-2"
    />
    <p-button
      (onClick)="deleteSelectedClientes()"
      icon="pi pi-trash"
      label="Eliminar"
      severity="danger"
      [disabled]="!selectedClientes || !selectedClientes.length"
    />
  </ng-template>
</p-toolbar>

<p-table
  #dt
  [value]="clientes"
  [(selection)]="selectedClientes"
  dataKey="id"
  [paginator]="true"
  [rows]="10"
  [rowsPerPageOptions]="[10, 20, 50]"
  [globalFilterFields]="[
    'contact_name',
    'business_name',
    'code',
    'municipality_code',
    'phone',
  ]"
  [resizableColumns]="true"
  [scrollable]="true"
  scrollHeight="500px"
>
  <ng-template pTemplate="caption">
    <div class="flex justify-between items-center">
      <span class="text-xl font-semibold">Clientes</span>
      <span class="p-input-icon-left">
        <input
          type="text"
          pInputText
          placeholder="Buscar..."
          (input)="onGlobalFilter($event)"
        />
      </span>
    </div>
  </ng-template>

  <ng-template pTemplate="header">
    <tr>
      <th style="width: 3rem">
        <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
      </th>
      <th *ngFor="let col of cols" [pSortableColumn]="col.field">
        {{ col.header }}
        <p-sortIcon [field]="col.field"></p-sortIcon>
      </th>
      <th>Acciones</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-cliente>
    <tr>
      <td>
        <p-tableCheckbox [value]="cliente"></p-tableCheckbox>
      </td>
      <td *ngFor="let col of cols">
        {{ cliente[col.field] }}
      </td>
      <td>
        <p-button
          icon="pi pi-pencil"
          (click)="editCliente(cliente)"
          styleClass="p-button-rounded p-button-text mr-2"
        ></p-button>
        <p-button
          icon="pi pi-trash"
          (click)="deleteCliente(cliente)"
          styleClass="p-button-rounded p-button-danger p-button-text"
        ></p-button>
      </td>
    </tr>
  </ng-template>
</p-table>

<p-dialog
  [(visible)]="clienteDialog"
  [modal]="true"
  [style]="{ width: '450px' }"
  header="Detalles del Cliente"
>
  <ng-template #content>
    <div class="flex flex-col gap-6">
      <div>
        <label class="block font-bold mb-3" for="contact_name"
          >Nombre Contacto*</label
        >
        <input
          [(ngModel)]="cliente.contact_name"
          id="contact_name"
          pInputText
          type="text"
          class="w-full"
          required
        />
        <small *ngIf="submitted && !cliente.contact_name" class="text-red-500"
          >Este campo es obligatorio.</small
        >
      </div>

      <div>
        <label class="block font-bold mb-3" for="business_name"
          >Nombre Negocio</label
        >
        <input
          [(ngModel)]="cliente.business_name"
          id="business_name"
          pInputText
          type="text"
          class="w-full"
        />
      </div>

      <
      <div>
        <label class="block font-bold mb-3" for="departamento"
          >Departamento*</label
        >
        <p-dropdown
          [(ngModel)]="cliente.municipality_code"
          [options]="departamentos"
          optionLabel="name"
          optionValue="code"
          (onChange)="onDepartamentoSeleccionado($event.value)"
          placeholder="Seleccione"
          class="w-full"
        >
        </p-dropdown>
      </div>

      <div>
        <label class="block font-bold mb-3" for="municipio">Municipio*</label>
        <p-dropdown
          [(ngModel)]="cliente.municipality_code"
          [options]="municipios"
          optionLabel="name"
          optionValue="code"
          placeholder="Seleccione"
          class="w-full"
        >
        </p-dropdown>
      </div>

      <div>
        <label class="block font-bold mb-3" for="address">Dirección</label>
        <textarea
          [(ngModel)]="cliente.address"
          id="address"
          pTextarea
          rows="2"
          class="w-full"
        ></textarea>
      </div>

      <div>
        <label class="block font-bold mb-3" for="nit">NIT</label>
        <input
          [(ngModel)]="cliente.nit"
          id="nit"
          pInputText
          type="text"
          class="w-full"
        />
      </div>

      <div>
        <label class="block font-bold mb-3" for="warehouse_manager"
          >Encargado Bodega</label
        >
        <input
          [(ngModel)]="cliente.warehouse_manager"
          id="warehouse_manager"
          pInputText
          type="text"
          class="w-full"
        />
      </div>

      <div>
        <label class="block font-bold mb-3" for="phone">Teléfono</label>
        <input
          [(ngModel)]="cliente.phone"
          id="phone"
          pInputText
          type="text"
          placeholder="0000-0000"
          class="w-full"
        />
      </div>

      <div>
        <label class="block font-bold mb-3" for="sale_type"
          >Tipo de Venta*</label
        >
        <p-dropdown
          [(ngModel)]="cliente.sale_type"
          [options]="tiposVenta"
          inputId="sale_type"
          class="w-full"
          placeholder="Seleccione"
        >
        </p-dropdown>
      </div>

      <div>
        <label class="block font-bold mb-3" for="notes">Observaciones</label>
        <textarea
          [(ngModel)]="cliente.notes"
          id="notes"
          pTextarea
          rows="2"
          class="w-full"
        ></textarea>
      </div>
    </div>
  </ng-template>

  <ng-template #footer>
    <p-button (click)="hideDialog()" icon="pi pi-times" label="Cancelar" text />
    <p-button (click)="saveCliente()" icon="pi pi-check" label="Guardar" />
  </ng-template>
</p-dialog>

<p-confirmDialog></p-confirmDialog>
